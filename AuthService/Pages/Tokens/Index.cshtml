@page "/admin/tokens"
@model AuthService.Pages.Tokens.IndexModel
@{
    ViewData["Title"] = "Token Management";
}

<div class="page-header">
    <h2>Refresh Tokens</h2>
    <button class="btn btn-danger" onclick="revokeExpired()">Revoke Expired</button>
</div>

<div class="stats-row">
    <div class="stat-box">
        <span class="stat-label">Total Tokens</span>
        <span class="stat-value">@Model.TotalTokens</span>
    </div>
    <div class="stat-box">
        <span class="stat-label">Active</span>
        <span class="stat-value text-success">@Model.ActiveTokens</span>
    </div>
    <div class="stat-box">
        <span class="stat-label">Expired</span>
        <span class="stat-value text-warning">@Model.ExpiredTokens</span>
    </div>
    <div class="stat-box">
        <span class="stat-label">Revoked</span>
        <span class="stat-value text-danger">@Model.RevokedTokens</span>
    </div>
</div>

<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>User</th>
                <th>Application</th>
                <th>Created</th>
                <th>Expires</th>
                <th>Created By IP</th>
                <th>Device</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var token in Model.Tokens)
            {
                <tr>
                    <td>@token.User.Email</td>
                    <td>@(token.Application?.Name ?? "Legacy")</td>
                    <td>@token.CreatedAt.ToString("yyyy-MM-dd HH:mm")</td>
                    <td>@token.ExpiresAt.ToString("yyyy-MM-dd HH:mm")</td>
                    <td>@token.CreatedByIp</td>
                    <td>@(token.DeviceInfo ?? "Unknown")</td>
                    <td>
                        @if (token.IsRevoked)
                        {
                            <span class="badge badge-danger">Revoked</span>
                        }
                        else if (token.IsExpired)
                        {
                            <span class="badge badge-warning">Expired</span>
                        }
                        else
                        {
                            <span class="badge badge-success">Active</span>
                        }
                    </td>
                    <td>
                        @if (!token.IsRevoked && !token.IsExpired)
                        {
                            <button onclick="revokeToken('@token.Id')" class="btn-link text-danger">Revoke</button>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
